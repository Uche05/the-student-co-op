{% extends "base.html" %}

{% block content %}
<div class="card max-w-md mx-auto p-8">
    <h2 class="text-navy text-2xl font-bold mb-6">Sign In</h2>
    
    <input type="email" id="email" placeholder="Student Email" class="w-full p-3 border rounded mb-4">
    <input type="password" id="password" placeholder="Password" class="w-full p-3 border rounded mb-6">
    
    <button type="button" onclick="signInStudent()" class="btn w-full">Sign In</button>
    
    <p id="error-message" class="text-red-500 text-sm mt-4"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script>
    // Paste your Firebase Config here from the Firebase Console
    const firebaseConfig = {
        apiKey: "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDQ0+FgcXkYj6N/\ncwNk+7S+k6x9aFcVV/L0sO59PdMfktL6/0cKMEAEgqCJVNqoZUZrTult7ROfDzh4\nN3Qe55yj0xv6RcrCd8BZYkivzuW1uKNNSvSoNJ2pXHqLgXXfwo+WBHo5WM4kRl3R\nUixUgOlMxTGBf0wQwI/p4Avihq1lgg6rzlEFo3ltAJXSZLk2lsjL6/OjLr6yGpc+\nRd3H94/ge83K/F8Yz48Z1M8Jja/zYECtV4y0oaQKSQlEosfxGDwz+t0rUExRJXTn\nO8uB26AahBGbZ3l0XTEcbbVonr/ngiHjUC9i6f5yJP80+Fo5rWIy2mqSksUlkkfW\nDlmQL6iPAgMBAAECggEAJyMWkacinV5KM5ggEjx0PuVZRfWYoIjnoUFJqRI9r6Sq\nQt01+KxbSx0aLjLHehjk7jaPXAk7DKvjFvC5pBMfUbq+exS6b+DWnUnkuoJJndmZ\nTWKXYLDfvX51/xBHwaRqmaCEMZw5oiXH7nN6mGnCj59DbHQpktgsAJZ7U7yO4b98\nCjZ4o0YJ539h5C94n6XeyeVY0P6oqRjJv+LPE0tF5ZGvdGgDVm5MRxp1KiisVk8w\nAV0KIOlzcaifHnY49qMCNPRjYwHPuF3TQhSQOwoOPN6eh85m5IuwMYLGxWRig/+k\nU/Ai+WxEqo2hbin/p0wQ6P5MeAFXAI77cdFZxg6D8QKBgQDo61GeWpU17dAf/XMz\nubuj0tqRgeTbDNeJz2c0aG4JADxxQqmk6QUXPD65iY8QB3Nk1YzWfL6x5bfEjuNu\nb3smtAgT8FMFw8KQrYjvTqQFyXSkOAsNYv5B0jsXzCaolesDTclOfbcTSZRDHpRg\nC8xG5lpvvVI8Z0zpX9qWemxw0QKBgQDlhWiJJ6ju7/kwF0HaYJ1GOMqg4/2qFU1/\ncwF9kfgdMlBTrtH6IhWCBJv3aUI3sBMz5EaRyU3Z090BPZJswedEKtMxH3O66cU8\nKZyiqWjz07cpI/AumpuPoNde/GTq8nYLuEW3OsYY4WxVVmEFeu4ZA+viEMsLPcQP\noOcUej/bXwKBgBtYNRbQL6BLMRnwWWwDLCJJiNt4UnPdCBjnvogKkpB/9JifaOcx\nbCWULxD9M0yAc22tHIG513FvNKng1JaMg/rBPAmLN1P/7YGqvd7Kbrs3MXhuE+4Y\nZx03HzTmBMvZ/eM/aJjMbYfYJY3TszurZuoT9R4VLehlgEQNus3bxYthAoGAVw6F\nGhDa+NY49E6+AbDHtszvvpr7qjmuTXs3w4NMUva0lSkoJ/IpqklJR0y7exfkELiz\nM7ThPJApscDC+1GJAMgllupRIUJuN2WpLeGIF4PkY0xoW6T1AEOHrVWaiasxrzxT\n5S372ZAXYT8ESenYydA89mBcQ4VICo2DWLcN5Y0CgYBkgIjiFD07Z13FRs8+sJlW\nUEunvMmAnbsF6jlA90ZKRtIVyoCk2uxaxwWRYBtXDX/T6nY24ieq4Qq13m9KbsPf\nXTSxvL3ue5Vqaq28N1Wo7NdPKxUzMbOWNt8CQd/TPhuW60YKoehGnpgMogWZ6JFs\nlhRV7J0gC1D3tBfvb+lSPA==\n-----END PRIVATE KEY-----\n",
        authDomain: "https://console.firebase.google.com/u/0/project/student-co-op/authentication/users",
        projectId: "student-co-op",
    };
    firebase.initializeApp(firebaseConfig);

    async function signInStudent() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        try {
            // 1. Sign in with Firebase
            const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
            const user = userCredential.user;

            // 2. Get the ID Token to send to Flask
            const idToken = await user.getIdToken();

            // 3. Send to Flask to set the session
            const response = await fetch('/login-session', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: idToken })
            });

            if (response.ok) {
                window.location.href = "/dashboard";
            }
        } catch (error) {
            document.getElementById('error-message').innerText = error.message;
        }
    }
</script>
{% endblock %}